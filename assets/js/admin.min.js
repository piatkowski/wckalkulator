!function(e){"use strict";var v={},o={};e(document).ready(function(h){h("body").hasClass("folded")||h("body").addClass("folded");var n=[],i={};h("#f-field-list").sortable({handle:".header",placeholder:"wck-sortable-placeholder",tolerance:"pointer"}),h("#extra-inputs, #addon-inputs").sortable({handle:".action-drag",placeholder:"wck-sortable-placeholder",tolerance:"pointer"}),h('<input type="hidden" class="wck-global-color-picker" />').insertBefore("#wpwrap"),v.colorpicker=h("input.wck-global-color-picker"),v.colorpicker.iris(),v.expressionLastFocusedInput=null,v.wpMediaFrame=null,v.wpMediaTarget=null,v.iconPreloader="data:image/gif;base64,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",v.fieldsLayout="one-col",v.toggleButton=function(e,t){return t.preventDefault(),e.hasClass("woocommerce-input-toggle--disabled")?(e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"),!0):(e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled"),!1)},v.fullscreenMode=function(e){e?(h("body").css("overflow","hidden"),h("#postbox-container-2").addClass("fullscreen")):(h("body").css("overflow","auto"),h("#postbox-container-2").removeClass("fullscreen"))},h(".wck-toggle-layout").on("click",function(e){e=v.toggleButton(h(this),e);v.fieldsLayout=e?"two-col":"one-col",v.updateLayout()}),h(".wck-toggle-fullscreen").on("click",function(e){e=v.toggleButton(h(this),e);v.fullscreenMode(e)}),h(".wck-toggle-expand").on("click",function(e){e=v.toggleButton(h(this),e);h(".action-toggle.dashicons-arrow-"+(e?"down":"up")+"-alt2").trigger("click")}),h("body").on("click",".wck-toggle-colspan",function(e){e.preventDefault();e=h(this).parent().parent().parent();h(this).hasClass("woocommerce-input-toggle--disabled")?(h(this).removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"),e.addClass("wck-layout-colspan"),e.find(".f-colspan").val(2)):(h(this).removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled"),e.removeClass("wck-layout-colspan"),e.find(".f-colspan").val(1))}),h(".action-save-post").on("click",function(e){e.preventDefault(),h("#publish").trigger("click"),h("#publish").hasClass("disabled")&&h(this).prop("disabled",!0).addClass("disabled")}),h("body").on("click",".action-duplicate",function(e){e.preventDefault();var e=h(this).parent().parent().parent(),t=e.clone();t.hide(),t.find(".f-title").val(""),t.find(".f-name").val(""),t.insertAfter(e),t.fadeIn(1500,function(){t.find(".dashicons-arrow-down-alt2").trigger("click"),h(this).find(".f-title").fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150),h(this).find(".f-name").fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150)})}),v.shouldHideExprToolbar=!1,v.stateExprToolbar=!1,h("body").on("focusin","#wck_expression .input-icon input, #wck_inventory .input-icon input, input.expression-editor-enabled",function(e){v.expressionLastFocusedInput=h(this),v.shouldHideExprToolbar=!1;var t=h(this).offset(),i=h(this).outerHeight(),a=h("#wck_expression").offset();h("#wck-expression-toolbar").css({top:t.top-a.top-i-h("#wck-expression-toolbar").outerHeight()-20,left:t.left-a.left}),v.stateExprToolbar||(v.stateExprToolbar=!0,v.saveFields(),h("#wck-parameters .first-selected").prop("selected",!0),h("#wck-expression-toolbar").stop(!0,!1).fadeIn("fast")),h("#wck-parameters .total-price").toggle(h(this).hasClass("show-total-price")),h(this).hasClass("show-total-price")||"{total_price}"!==h("#wck-parameters").val()||h("#wck-parameters").val("")}).on("focusout","#wck_expression input, #wck_inventory input, input.expression-editor-enabled",function(e){v.shouldHideExprToolbar=!(e.relatedTarget&&h("#wck-expression-toolbar").has(e.relatedTarget).length),setTimeout(function(){v.stateExprToolbar&&v.shouldHideExprToolbar&&(h("#wck-expression-toolbar").stop(!0,!1).fadeOut("fast"),v.stateExprToolbar=!1)},200)}).on("click","#wck-expression-toolbar",function(e){e.target!==e.currentTarget&&"OPTION"!==e.target.tagName||v.expressionLastFocusedInput.focus()}).on("click","button.add-field-to-formula, button.add-operator",function(e){e.preventDefault();var t,i,a,e=v.expressionLastFocusedInput;e||(e=h(".input-icon").find("input:visible").first()).focus(),e&&e.length&&(null!==(t=(h(this).hasClass("add-operator")?h(this):h("#wck-parameters")).val())&&(i=e[0].selectionStart,a=e.val(),e.val(a.slice(0,i)+t+(h(this).data("ending")||"")+a.slice(i)),e.focus(),i+=t.length,e[0].setSelectionRange(i,i)))}).on("click",".field .pairs .action-add",function(){var e=h(this).prev(".pair").clone().insertBefore(h(this));e.find("input").val(""),h(this).hasClass("productbundlecheckbox")&&(e.find(".select2").remove(),e.find("select.fs-name").removeClass("select2-hidden-accessible enhanced").html("").val(""),h(document.body).trigger("wc-enhanced-select-init"))}).on("click",".field .pairs .action-showimport",function(){h(this).parent().find("div.importer").toggle()}).on("click",".field .pairs .action-import",function(){var i=h(this),e=i.parent().find("textarea").val().trim().split("\n");Array.isArray(e)&&e.forEach(function(e){var e=e.trim().split(";"),t=i.parent().parent().find(".pair").last(),t=t.clone().insertAfter(t);2===e.length?(t.find("input.fs-name").val(e[0]),t.find("input.fs-title").val(e[1])):1===e.length&&t.find("input.fs-title").val(e[0])})}).on("click",".field .pairs .action-removeall",function(){confirm("Are you sure?")&&h(this).parent().find(".pair").slice(1).remove()}).on("click",".field .pair .action-delete",function(){1<h(this).closest(".pairs").children(".pair").length?confirm("Are you sure?")&&h(this).closest(".pair").remove():alert("You cannot remove the last item!")}).on("click",".field .header .action-delete",function(){var e;confirm("Are you sure?")&&(e=h(this).closest("li")).fadeOut("slow",function(){e.remove()})}).on("click",".field .header .action-toggle",function(){var e=h(this).closest(".field").find(".body");e.slideToggle(300),h(this).toggleClass("dashicons-arrow-up-alt2"),h(this).toggleClass("dashicons-arrow-down-alt2"),h(this).hasClass("dashicons-arrow-down-alt2")?h(this).parent().find(".name").text((e.find(".f-title").length?"- "+e.find(".f-title").val():"")+" {"+e.find(".f-name").val()+"}"):h(this).parent().find(".name").text("")}).on("click","#add-field-button",function(e){e.preventDefault();e=h("#select-field").val(),e=v.addField(e);h("html, body").animate({scrollTop:h("#"+e).offset().top-50},1e3)}).on("click",".expression_conditional .input-group .action-delete",function(){var e=h(this).closest(".input-group");1<h("#extra-inputs .input-group").length?confirm("Are you sure?")&&e.hide("slow",function(){e.remove()}):alert("You cannot remove the last condition!")}).on("click",".expression_addon .input-group .action-delete",function(){var e=h(this).closest(".input-group");1<h("#addon-inputs .input-group").length?confirm("Are you sure?")&&e.hide("slow",function(){e.remove()}):alert("You cannot remove the last addon!")}).on("click",".action-add-image",function(e){e.preventDefault(),v.wpMediaTarget=h(this),v.wpMediaFrame||(v.wpMediaFrame=wp.media({multiple:!1,button:{text:"Select this image"}}),v.wpMediaFrame.on("select",function(){var e=v.wpMediaFrame.state().get("selection").first().toJSON();"A"===v.wpMediaTarget.prop("tagName")?(v.wpMediaTarget.next("img.wp-media-image-preview").attr("src",e.url),v.wpMediaTarget.next().next("input.wp-media-image-id").attr("value",e.id),v.wpMediaTarget.hide()):(v.wpMediaTarget.attr("src",e.url),v.wpMediaTarget.next("input.wp-media-image-id").attr("value",e.id))})),v.wpMediaFrame.open()}).on("click",".action-add-attachment",function(e){e.preventDefault(),v.wpMediaTarget=h(this),v.wpMediaFrame||(v.wpMediaFrame=wp.media({multiple:!1,button:{text:"Select this file"}}),v.wpMediaFrame.on("select",function(){var e=v.wpMediaFrame.state().get("selection").first().toJSON();v.wpMediaTarget.next("input.wp-media-attachment-id").val(e.id),v.wpMediaTarget.next().next("a.wp-media-attachment-preview").attr("href",e.url).text(e.url)})),v.wpMediaFrame.open()}).on("focus",'[data-type="colorswatches"] input.fs-title',function(e){e.preventDefault();var a=h(this);v.colorpicker.iris("show"),h(".iris-picker").css({top:a.offset().top+40,left:a.offset().left}),v.colorpicker.iris("option","change",function(e,t){a.val(t.color.toString());var i=t.color.toRgb(),i=(i.r+i.g+i.b)/2<200?"#FFFFFF":"#000000";a.css({"background-color":t.color.toString(),color:i})}),v.colorpicker.iris("color",h(this).val())}).on("click","input.allowed-extensions",function(){var e="#"+h(this).closest("li").attr("id"),t=[];h(e+" input.allowed-extensions:checked").each(function(){t.push(h(this).data("extension"))}),h(e+" input.fu-allowed-extensions").val(t.join("|"))}).on("change","input.f-name",function(){var e,t,i=h(this),a=h(this).val().trim();""!==a&&h("#wck_fields_editor input.f-name").each(function(){if(h(this).val()===a&&!h(this).is(i))return alert("The name {"+a+"} is already in use! Choose another name."),i.val(""),!1}),h(this)[0].checkValidity()&&void 0!==h(this).data("lastValid")&&(e=h(this).data("lastValid"))!==a&&(t=!1,h("#wck_expression input[type=text], #wck_fields_editor input.f-visibility, #wck_fields_editor input.f-visibility-readable, #wck_fields_editor input.visibility-readable").each(function(){if(h(this).val().includes(e))return!(t=!0)}),t&&confirm("Wait! Seems like {"+e+"} is used in formulas! Do you want to replace {"+e+"} in all formulas? {"+e+"} will be changed to {"+a+"}")&&(h("#wck_expression input[type=text], #wck_fields_editor input.f-visibility, #wck_fields_editor input.f-visibility-readable, #wck_fields_editor input.visibility-readable").each(function(){h(this).val(h(this).val().replaceAll("{"+e+"}","{"+a+"}").replaceAll("{"+e+":","{"+a+":").replaceAll('"field":"'+e+'"','"field":"'+a+'"'))}),h(this).data("lastValid",a)))}).on("focusin","input.f-name",function(){h(this)[0].checkValidity()&&h(this).data("lastValid",h(this).val())}),h(".iris-square-value").on("click",function(e){e.preventDefault()}),h(document).click(function(e){h(e.target).closest('.iris-picker, [data-type="colorswatches"] input.fs-title').length||h(".iris-picker").is(":visible")&&v.colorpicker.iris("hide")}),h("form#post").submit(function(e){return v.saveFields(),v.saved?(v.saveExpression(),!(!v.expr_saved&&"off"!==v.expression.mode)||(e.preventDefault(),alert("Expression is required. Fill in required fields and try again!"),!1)):(e.preventDefault(),!1)}),v.init=function(){v.fieldList=h("#f-field-list"),v.html=wck_fields_html,v.fields={},v.saved=!1,v.expr_saved=!1,v.counter=0,v.expression={mode:h("input.expression_type:checked").val()},v.loadJSONdata(),v.showExpressionEditor(),v.changeAssignType(),h("form#post").attr("novalidate",""),v.buildTooltips(""),v.updateLayout(),h("#wck-parameters .first-selected").prop("selected",!0)},v.updateLayout=function(){"two-col"===v.fieldsLayout?v.fieldList.addClass("layout-two-col"):v.fieldList.removeClass("layout-two-col")},v.buildTooltips=function(e){h(e+"span.wck-field-tip").tipTip({attribute:"title",defaultPosition:"left"})},v.changeAssignType=function(){var e="1"===h("#assign_type").val();h("#assign_products, #assign_categories, #assign_tags, #assign_attributes").prop("disabled",e),h(".hide-if-disabled").toggle(!e)},h("#assign_type").on("change",v.changeAssignType),v.preloadMedia=function(e,t){wp.media.attachment(e).fetch().then(function(){t(wp.media.attachment(e))})},v.addField=function(e){v.counter+=1;var t="wkfield-"+v.counter;return h("li.welcome",v.fieldList).remove(),v.fieldList.append(h("<li/>",{"data-type":e,class:"form-invalid",id:t}).append(v.html[e].replace("{id}",t))),v.buildTooltips("#"+t+" "),0<h("#"+t).find(".pairs").length&&h("#"+t+" .pairs").sortable({placeholder:"wck-sortable-placeholder",tolerance:"pointer"}),t},h(window).on("beforeunload",function(){if(!1===v.saved)return""}),v.saveFields=function(){v.fields={},n=[];var p=0===h("li .field",v.fieldList).length;if(h("label.error").remove(),v.saved=!1,h("#wck-parameters .defined-fields").html(""),v.appendGlobalParameters(),p)return alert("Please add at least one field before saving."),!1;h("li .field",v.fieldList).each(function(){var e=h(this),t=e.find("input.f-name"),i=e.find("input.f-title"),a=e.find("input.f-hint"),n=e.find("input.f-default-value"),o=e.find("input.f-css-class"),s={type:e.data("type"),use_expression:!0===e.data("use-expression"),name:t.val(),title:i.val(),before_title:e.find("input.f-before-title").val(),after_title:e.find("input.f-after-title").val(),hint:a.val(),default_value:n.val(),css_class:o.val(),layout:v.fieldsLayout,colspan:e.find("input.f-colspan").val(),visibility:e.find("input.f-visibility").val(),visibility_readable:e.find("input.f-visibility-readable").val()};if(0<e.find("select.f-required").length)switch(e.find("select.f-required").val()){case"on":s.required="1";break;case"if-visible":s.required="2";break;case"off":s.required="0"}else s.required="1";t=e.find("input.f-price"),0<t.length&&(s.price=t.val(),""!==s.price&&(s.use_expression=!0)),i=e.find("input.fimg-width");switch(0<i.length&&(s.image_size=i.val()),s.type){case"select":case"radio":case"imageselect":case"imageswatches":case"colorswatches":case"radiogroup":case"checkboxgroup":case"productbundlecheckbox":s.options_name=[],s.options_title=[],"imageselect"!==s.type&&"imageswatches"!==s.type||(s.options_image=[]),"checkboxgroup"!==s.type&&"productbundlecheckbox"!==s.type||(s.select_limit=e.find("input.fcbg-limit").val());var l="productbundlecheckbox"===s.type;l&&(s.options_product_name=[]),e.find(".fs-option").each(function(){var e=h(this).find("input.fs-title"),t=h(this).find(".fs-name"),i=h(this).find("input.f-default-value").is(":checked");void 0!==i&&!0===i&&(s.default_value=t.val()+":"+e.val()),s.options_name.push(t.val()+":"+e.val()),s.options_title.push(e.val()),l&&s.options_product_name.push(t.text()),"imageselect"!==s.type&&"imageswatches"!==s.type||(i=h(this).find("input.fs-image"),s.options_image.push(i.val()))});break;case"dropdown":s.options_title=[],e.find(".fs-option").each(function(){var e=h(this).find("input.fs-title"),t=h(this).find("input.f-default-value").is(":checked");void 0!==t&&!0===t&&(s.default_value=e.val()),s.options_title.push(e.val())});break;case"number":var d=e.find("input.fn-min-value"),d=(s.min=d.val(),e.find("input.fn-max-value"));s.max=d.val();break;case"checkbox":d=e.find("select.fcb-default-state");s.default_state="on"===d.val();break;case"text":case"textarea":case"email":var d=e.find("input.ft-min-length"),r=e.find("input.ft-max-length"),c=e.find("input.ft-pattern");s.min=d.val(),s.max=r.val(),0<c.length&&(s.pattern=c.val());break;case"colorpicker":case"datepicker":case"rangedatepicker":d=e.find("input.fdp-disallow-past-date");s.disallow_past_date=d.is(":checked");break;case"imageupload":case"fileupload":s.max_file_size=e.find("input.fu-max-file-size").val(),s.allowed_extensions=e.find("input.fu-allowed-extensions").val();break;case"html":case"paragraph":case"hidden":case"attachment":s.content=e.find(".fst-content").val();break;case"formula":s.content=e.find(".fst-content").val(),s.display_on_user_cart="on"===e.find(".fst-display-on-user-cart").val();break;case"link":s.content=e.find(".fst-content").val(),s.target=e.find(".fst-target").val();break;case"heading":s.content=e.find(".fst-content").val(),s.level=e.find(".fst-level").val()}""!==s.name&&s.name in v.fields&&(p=!0,alert("Field names must be unique! The '"+s.name+"' name is used more than once.")),p||v.appendFormulaVars(s)}),h("form#post")[0].checkValidity()||(p=!0,h("input:invalid").closest(".field").find(".action-toggle.dashicons-arrow-down-alt2").trigger("click"),h("input:invalid").each(function(){h('<label class="error"><span class="dashicons dashicons-warning"></span> '+h(this)[0].validationMessage+"</label>").insertBefore(h(this))})),p&&h("label.error").length&&h("html, body").animate({scrollTop:h("label.error").first().offset().top-160},1e3),v.saveJSONdata(),v.saved=!p},v.appendGlobalParameters=function(){h("#wck-parameters .global-parameters").html(""),h.each(wck_global_parameters,function(i,e){var i="global:"+i,a="";n.push(i),e="object"==typeof e?(h.each(e,function(e,t){a=a+'<option value="{'+i+"}"+("['"+e+"']")+'">'+i.replace("global:","")+"["+e+"] = "+t+"</option>"}),""):" = "+e,h("#wck-parameters .global-parameters").append('<option value="{'+i+'}">'+i.replace("global:","")+e+"</option>"),h("#wck-parameters .global-parameters").append(a)})},v.appendFormulaVars=function(e){(v.fields[e.name]=e).use_expression&&("checkboxgroup"!==e.type?(n.push(e.name),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+'}">"'+e.title+'" value/price {'+e.name+"}</option>")):(n.push(e.name),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+'}">Array of selected values {'+e.name+"}</option>"),n.push(e.name+":sum"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':sum}">Sum of "'+e.title+'" {'+e.name+":sum}</option>"),n.push(e.name+":min"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':min}">Min. value of "'+e.title+'" {'+e.name+":min}</option>"),n.push(e.name+":max"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':max}">Max. value of "'+e.title+'" {'+e.name+":max}</option>")),"text"!==e.type&&"textarea"!==e.type||(n.push(e.name+":text"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':text}">Text value of "'+e.title+'" {'+e.name+":text}</option>")),"rangedatepicker"===e.type?(n.push(e.name+":date_from"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':date_from}">Date "from" of "'+e.title+'" {'+e.name+":date_from}</option>"),n.push(e.name+":date_to"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':date_to}">Date "to" of "'+e.title+'" {'+e.name+":date_to}</option>"),n.push(e.name+":days"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':days}">Days between dates of "'+e.title+'" {'+e.name+":days}</option>")):"datepicker"===e.type?(n.push(e.name+":date"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':date}">Timestamp of "'+e.title+'" {'+e.name+":date}</option>")):"imageupload"!==e.type&&"fileupload"!==e.type||(n.push(e.name+":size"),h("#wck-parameters .defined-fields").append('<option value="{'+e.name+':size}">File size of "'+e.title+'" {'+e.name+":size} [MB]</option>")))},v.saveJSONdata=function(){0<Object.keys(v.fields).length&&h("input[name=_wck_fieldset]").val(JSON.stringify(v.fields))},v.loadJSONdata=function(){var t;"object"==typeof wck_load_fieldset&&(t=!1,h.each(wck_load_fieldset,function(){t||(this.hasOwnProperty("layout")&&"two-col"===this.layout&&h(".wck-toggle-layout").trigger("click"),t=!0);var o,s,l,d,r,c,p,f=v.addField(this.type),u=h("#"+f+" .field"),e=(h("#"+f+" .f-name").val(this.name),this.hasOwnProperty("colspan")&&(h("#"+f+" .f-colspan").val(this.colspan),"2"===this.colspan&&h("#"+f+" .wck-toggle-colspan").trigger("click")),h("#"+f+" .f-title").val(this.title),this.hasOwnProperty("before_title")&&h("#"+f+" .f-before-title").val(this.before_title),this.hasOwnProperty("after_title")&&h("#"+f+" .f-after-title").val(this.after_title),h("#"+f+" .f-hint").val(this.hint),h("#"+f+" .f-css-class").val(this.css_class),0<h("#"+f+" .f-required").length&&h("#"+f+" .f-required").val("1"===this.required?"on":"2"===this.required?"if-visible":"off"),this.hasOwnProperty("visibility")&&(h("#"+f+" .f-visibility").val(this.visibility),h("#"+f+" .f-visibility-readable").val(this.visibility_readable),""!==this.visibility_readable&&h("#"+f+" .visibility-readable").val("Rule preview: "+this.visibility_readable)),h("#"+f+" .f-price")),e=(0<e.length&&e.val(this.price),h("#"+f+" .fimg-width"));0<e.length&&e.val(this.image_size),"dropdown"===this.type?(o=this.options_title,l=this.default_value,d=!0,r=null,h.each(o,function(e,t){var i;d?((i=u.find(".fs-option")).find("input.fs-title").val(t),l===t&&(r=i.find("input.f-default-value")),d=!1):((i=u.find(".fs-option").last().clone().insertBefore(h("#"+f+" .fs-options .action-add"))).find("input.fs-title").val(t),l===t&&(r=i.find("input.f-default-value"))),r&&r.prop("checked",!0)})):0<=["select","radio","imageselect","radiogroup","checkboxgroup","imageswatches","colorswatches","productbundlecheckbox"].indexOf(this.type)?(e=this.options_name,o=this.options_title,l=this.default_value,"imageselect"!==this.type&&"imageswatches"!==this.type||(s=this.options_image,wp.media.attachment(s).fetch()),"checkboxgroup"!==this.type&&"productbundlecheckbox"!==this.type||h("#"+f+" .fcbg-limit").val(this.select_limit),d=!0,r=null,c="productbundlecheckbox"===this.type,p=this.hasOwnProperty("options_product_name")?this.options_product_name:[],h.each(e,function(e,t){var i,a,n;0<=t.indexOf(":")&&(t=t.slice(0,t.indexOf(":"))),d?(a=u.find(".fs-option"),c?(a.find("select.fs-name").html(h("<option>",{value:t,text:void 0!==p[e]?p[e]:"#"+t})),console.log("add first")):a.find("input.fs-name").val(t),a.find("input.fs-title").val(o[e]),0<(i=a.find("input.fs-image")).length&&(i.val(s[e]),a.find("a.action-add-image").hide(),a.find(".wp-media-image-preview").attr("src",v.iconPreloader),v.preloadMedia(s[e],function(e){a.find(".wp-media-image-preview").attr("src",e.get("url"))})),l===t&&(r=a.find("input.f-default-value")),d=!1):(n=u.find(".fs-option").last().clone().insertBefore(h("#"+f+" .fs-options .action-add")),c?(n.find("select.fs-name").html(h("<option>",{value:t,text:void 0!==p[e]?p[e]:"#"+t})),console.log("add next")):n.find("input.fs-name").val(t),n.find("input.fs-title").val(o[e]),0<(i=n.find("input.fs-image")).length&&(i.val(s[e]),n.find("a.action-add-image").hide(),n.find(".wp-media-image-preview").attr("src",v.iconPreloader),v.preloadMedia(s[e],function(e){n.find(".wp-media-image-preview").attr("src",e.get("url"))})),l===t&&(r=n.find("input.f-default-value"))),r&&r.prop("checked",!0)}),c&&h(document.body).trigger("wc-enhanced-select-init")):"number"===this.type?(h("#"+f+" .fn-min-value").val(this.min),h("#"+f+" .fn-max-value").val(this.max),h("#"+f+" .f-default-value").val(this.default_value)):"checkbox"===this.type?h("#"+f+" .fcb-default-state").val("1"===this.default_state?"on":"off"):"text"===this.type||"textarea"===this.type||"email"===this.type?(h("#"+f+" .ft-min-length").val(this.min),h("#"+f+" .ft-max-length").val(this.max),h("#"+f+" .f-default-value").val(this.default_value),"text"===this.type&&h("#"+f+" .ft-pattern").val(this.pattern)):"colorpicker"===this.type||"datepicker"===this.type||"rangedatepicker"===this.type?h("#"+f+" .fdp-disallow-past-date").prop("checked",this.disallow_past_date):"imageupload"===this.type||"fileupload"===this.type?(h("#"+f+" .fu-max-file-size").val(this.max_file_size),h("#"+f+" .fu-allowed-extensions").val(this.allowed_extensions),this.allowed_extensions.split("|").forEach(function(e){h("#"+f+" .allowed-extensions.ext-"+e).prop("checked",!0)})):0<=["html","paragraph","heading","hidden","link","attachment","formula"].indexOf(this.type)&&(h("#"+f+" .fst-content").val(this.content),"heading"===this.type?h("#"+f+" .fst-level").val(this.level):"link"===this.type?h("#"+f+" .fst-target").val(this.target):"attachment"===this.type?v.preloadMedia(this.content,function(e){h("#"+f+" .wp-media-attachment-preview").attr("href",e.get("url")).text(e.get("url"))}):"formula"===this.type&&h("#"+f+" .fst-display-on-user-cart").val("1"===this.display_on_user_cart?"on":"off"))}),v.saveFields())},v.showExpressionEditor=function(){h("div.expression_oneline, div.expression_conditional, div.expression_off, div.expression_addon").hide(),h("div.expression_"+v.expression.mode).show(),"off"===v.expression.mode?h(".off-hide").hide():h(".off-hide").show()},h("input.expression_type").on("change",function(){v.expression.mode=h(this).val(),v.expressionLastFocusedInput=null,v.showExpressionEditor()}),v.addCondition=function(e,t,i=!1){var a=h('<div class="input-group"><div class="input-buttons"><span class="action-drag dashicons dashicons-move"></span></div><div class="input-icon input-if"><input type="text" placeholder="Logical expression..." value=""><i></i></div><div class="input-icon input-equation"><input type="text" placeholder="Price formula..." value=""><i></i></div><div class="input-buttons"><span class="action-delete dashicons dashicons-trash"></span></div><div class="clearfix"></div></div>');h(".input-if input",a).val(e),h(".input-equation input",a).val(t),h(!0===i?"div#addon-inputs":"div#extra-inputs").append(a),v.autocomplete()},h("button.add-condition").on("click",function(){v.addCondition()}),h("button.add-addon").on("click",function(){v.addCondition("","",!0)}),v.autocomplete=function(){h(".input-icon input").bind("keydown",function(e){16!==e.keyCode&&219!==e.keyCode||(i[e.keyCode]=!0)}).autocomplete({minLength:0,source:function(e,t){!0===i[16]&&!0===i[219]&&t(n)},focus:function(){return!1},select:function(e,t){return delete i[16],delete i[219],this.value+=t.item.value+"}",!1}})},v.saveExpression=function(){var e,i,t=v.expression.mode;v.expr_saved=!1,"oneline"===t&&(v.expression.expr=h(".expression_oneline input").val(),""!==v.expression.expr&&(v.expr_saved=!0)),"conditional"===t&&(i=[],h(".expression_conditional .input-group").each(function(){var e=h(this).find(".input-if input").val(),t=h(this).find(".input-equation input").val();i.push({type:"condition",if:e,then:t})}),e=h(".expression_conditional .input-else input").val(),i.push({type:"else",if:"true",then:e}),v.expression.expr=i,0<v.expression.expr.length&&(v.expr_saved=!0)),"addon"===t&&(i=[],h(".expression_addon .input-group").each(function(){var e=h(this).find(".input-if input").val(),t=h(this).find(".input-equation input").val();i.push({type:"condition",if:e,then:t})}),v.expression.expr=i,0<v.expression.expr.length&&(v.expr_saved=!0)),"off"===t?h("input[name=_wck_expression]").val("off"):h("input[name=_wck_expression]").val(JSON.stringify(v.expression))},v.loadExpression=function(){"object"==typeof wck_load_expression?(v.expression.mode=wck_load_expression.mode,v.expression.expr=wck_load_expression.expr,"oneline"===v.expression.mode?(h(".expression_oneline input").val(v.expression.expr),h("input[name=_wck_choose_expression_type].expression_oneline").prop("checked",!0),v.showExpressionEditor(),v.addCondition()):"conditional"===v.expression.mode?(h.each(v.expression.expr,function(){"condition"===this.type?v.addCondition(this.if,this.then):"else"===this.type&&h(".input-else input").val(this.then)}),h("input[name=_wck_choose_expression_type].expression_conditional").prop("checked",!0),v.showExpressionEditor()):"addon"===v.expression.mode&&(h.each(v.expression.expr,function(){v.addCondition(this.if,this.then,!0)}),h("input[name=_wck_choose_expression_type].expression_addon").prop("checked",!0),v.showExpressionEditor())):(v.expression.mode="off",h("input[name=_wck_choose_expression_type].expression_off").prop("checked",!0),v.showExpressionEditor(),v.addCondition())},h("button.test-expression").on("click",function(){v.saveExpression()}),v.toolbarOnTop=!1,h(window).scroll(function(){100<h(this).scrollTop()?v.toolbarOnTop||h("#wck-toolbar").fadeOut(function(){v.toolbarOnTop=!0,h("#wck-toolbar").css({top:"0px",bottom:"auto"}).fadeIn()}):h("#postbox-container-2").hasClass("fullscreen")||v.toolbarOnTop&&h("#wck-toolbar").fadeOut(function(){v.toolbarOnTop=!1,h("#wck-toolbar").css({top:"auto",bottom:"0px"}).fadeIn()})}),o.window=h("#wck-cv-builder"),o.builder=o.window.find(".builder"),o.template=o.window.find(".template").children(),o.context=null,o.open=function(t){o.context=t;var i=o.template.find("select.p-field"),a=(i.empty(),v.saveFields(),i.append('<option value="" selected disabled>Choose field...</option>'),h.each(v.fieldList.find(".field"),function(){var e;"static"===h(this).data("group")||h(this).is(t)||(e=h(this).find(".f-name").val(),i.append('<option value="'+e+'">'+e+"</option>"))}),o.builder.append(o.template.clone()),o.builder.find(".or-condition").remove(),o.context.find(".f-visibility").val());try{a=JSON.parse(a)}catch(e){a=!1}"object"==typeof a?h.each(a,function(e,t){var i=!0;h.each(t,function(e,t){o.add(i?"or":"and",null,t),i=!1})}):o.add("or",null,null),o.window.find("span.self-name").text(t.find(".f-name").val()),o.window.show().css({display:"flex"})},o.close=function(){o.window.hide(),o.builder.empty()},o.add=function(e,t,i){(t=null===t?o.builder.find("."+e+"-group").last():t).append(o.window.find(".template ."+e+"-condition").clone());e=t.find(".and-condition").last();null!==i&&"object"==typeof i?(e.find(".p-field").val(i.field),e.find(".p-comparison").val(i.comp).trigger("change"),e.find(".p-value").val(i.value)):e.find(".p-value").val("")},o.validate=function(){var a=!0,e=o.builder.find(".and-condition");return e.find(".validation-error").removeClass("validation-error"),e.each(function(){var e=h(this).find(".p-field"),t=h(this).find(".p-comparison").val(),i=h(this).find(".p-value");[null,""].includes(e.val())&&(e.addClass("validation-error"),a=!1),i.prop("disabled")||""!==i.val()||(i.addClass("validation-error"),a=!1),["5","6","7","8"].includes(t)&&!i.val().match(/^-?\d*[\.,]?\d+$/)&&(i.addClass("validation-error"),a=!1),"9"===t&&""===i.val()&&(i.addClass("validation-error"),a=!1)}),a},o.window.on("click",".cv-action-and",function(e){e.preventDefault(),o.add("and",h(this).prev(),null)}),o.window.on("click",".cv-action-or",function(e){e.preventDefault(),o.add("or",h(this).prev(),null)}),o.window.on("click",".cv-remove",function(e){e.preventDefault(),(1===h(this).closest(".and-group").children().length?h(this).closest(".or-condition"):h(this).parent()).remove()}),o.window.on("change","select.p-comparison",function(e){var t=["1","2"].includes(h(this).val()),i=h(this).next(".p-value");i.prop("disabled",t),t&&i.val("")}),o.window.on("click",".cv-close",function(e){e.preventDefault(),o.close()}),o.window.on("click",".cv-save",function(e){if(e.preventDefault(),!o.validate())return alert("Please correct the form!"),!1;var a=[],n=[],e=(h.each(o.builder.find(".or-condition"),function(){var t=[],i=[];h.each(h(this).find(".and-condition"),function(){var e={field:h(this).find(".p-field").val(),comp:h(this).find(".p-comparison").val(),comp_text:h(this).find(".p-comparison option:selected").text(),value:h(this).find(".p-value").val()};t.push(e),i.push("{"+e.field+"} "+e.comp_text+" "+e.value)}),a.push(t),n.push(" ( "+i.join(" and ")+" ) ")}),n.join(" or ").replaceAll("  "," "));o.context.find(".f-visibility").val(0===a.length?"":JSON.stringify(a)),o.context.find(".f-visibility-readable").val(e),""!==e?o.context.find(".visibility-readable").val("Rule preview: "+e):o.context.find(".visibility-readable").val(""),o.close()}),h("body").on("click",".action-field-visibility",function(){var e=h(this).closest(".field");o.open(e)}),v.init(),v.loadExpression(),v.autocomplete()})}(jQuery);