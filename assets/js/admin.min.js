!function(e){"use strict";var u={},o={};e(document).ready(function(f){f("body").hasClass("folded")||f("body").addClass("folded");var n=[],t={};f("#f-field-list").sortable({handle:".header",placeholder:"wck-sortable-placeholder",tolerance:"pointer"}),f("#extra-inputs, #addon-inputs").sortable({handle:".action-drag",placeholder:"wck-sortable-placeholder",tolerance:"pointer"}),f('<input type="hidden" class="wck-global-color-picker" />').insertBefore("#wpwrap"),u.colorpicker=f("input.wck-global-color-picker"),u.colorpicker.iris(),u.expressionLastFocusedInput=null,u.wpMediaFrame=null,u.wpMediaTarget=null,u.iconPreloader="data:image/gif;base64,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",u.fieldsLayout="one-col",u.toggleButton=function(e,i){return i.preventDefault(),e.hasClass("woocommerce-input-toggle--disabled")?(e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"),!0):(e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled"),!1)},u.fullscreenMode=function(e){e?(f("body").css("overflow","hidden"),f("#postbox-container-2").addClass("fullscreen")):(f("body").css("overflow","auto"),f("#postbox-container-2").removeClass("fullscreen"))},f(".wck-toggle-layout").on("click",function(e){e=u.toggleButton(f(this),e);u.fieldsLayout=e?"two-col":"one-col",u.updateLayout()}),f(".wck-toggle-fullscreen").on("click",function(e){e=u.toggleButton(f(this),e);u.fullscreenMode(e)}),f(".wck-toggle-expand").on("click",function(e){e=u.toggleButton(f(this),e);f(".action-toggle.dashicons-arrow-"+(e?"down":"up")+"-alt2").trigger("click")}),f("body").on("click",".wck-toggle-colspan",function(e){e.preventDefault();e=f(this).parent().parent().parent();f(this).hasClass("woocommerce-input-toggle--disabled")?(f(this).removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"),e.addClass("wck-layout-colspan"),e.find(".f-colspan").val(2)):(f(this).removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled"),e.removeClass("wck-layout-colspan"),e.find(".f-colspan").val(1))}),f(".action-save-post").on("click",function(e){e.preventDefault(),f("#publish").trigger("click"),f("#publish").hasClass("disabled")&&f(this).prop("disabled",!0).addClass("disabled")}),f("body").on("click",".action-duplicate",function(e){e.preventDefault();var e=f(this).parent().parent().parent(),i=e.clone();i.hide(),i.find(".f-title").val(""),i.find(".f-name").val(""),i.insertAfter(e),i.fadeIn(1500,function(){i.find(".dashicons-arrow-down-alt2").trigger("click"),f(this).find(".f-title").fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150),f(this).find(".f-name").fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150).fadeOut(150).fadeIn(150)})}),u.shouldHideExprToolbar=!1,u.stateExprToolbar=!1,f("body").on("focusin","#wck_expression .input-icon input, #wck_inventory .input-icon input, input.expression-editor-enabled",function(e){u.expressionLastFocusedInput=f(this),u.shouldHideExprToolbar=!1;var i=f(this).offset(),t=f(this).outerHeight(),a=f("#wck_expression").offset();f("#wck-expression-toolbar").css({top:i.top-a.top-t-f("#wck-expression-toolbar").outerHeight()-20,left:i.left-a.left}),u.stateExprToolbar||(u.stateExprToolbar=!0,u.saveFields(),f("#wck-parameters .first-selected").prop("selected",!0),f("#wck-expression-toolbar").stop(!0,!1).fadeIn("fast")),f("#wck-parameters .total-price").toggle(f(this).hasClass("show-total-price")),f(this).hasClass("show-total-price")||"{total_price}"!==f("#wck-parameters").val()||f("#wck-parameters").val("")}).on("focusout","#wck_expression input, #wck_inventory input, input.expression-editor-enabled",function(e){u.shouldHideExprToolbar=!(e.relatedTarget&&f("#wck-expression-toolbar").has(e.relatedTarget).length),setTimeout(function(){u.stateExprToolbar&&u.shouldHideExprToolbar&&(f("#wck-expression-toolbar").stop(!0,!1).fadeOut("fast"),u.stateExprToolbar=!1)},200)}).on("click","#wck-expression-toolbar",function(e){e.target!==e.currentTarget&&"OPTION"!==e.target.tagName||u.expressionLastFocusedInput.focus()}).on("click","button.add-field-to-formula, button.add-operator",function(e){e.preventDefault();var i,t,a,e=u.expressionLastFocusedInput;e||(e=f(".input-icon").find("input:visible").first()).focus(),e&&e.length&&(null!==(i=(f(this).hasClass("add-operator")?f(this):f("#wck-parameters")).val())&&(t=e[0].selectionStart,a=e.val(),e.val(a.slice(0,t)+i+(f(this).data("ending")||"")+a.slice(t)),e.focus(),t+=i.length,e[0].setSelectionRange(t,t)))}).on("click",".field .pairs .action-add",function(){f(this).prev(".pair").clone().insertBefore(f(this)).find("input").val("")}).on("click",".field .pairs .action-showimport",function(){f(this).parent().find("div.importer").toggle()}).on("click",".field .pairs .action-import",function(){var t=f(this),e=t.parent().find("textarea").val().trim().split("\n");Array.isArray(e)&&e.forEach(function(e){var e=e.trim().split(";"),i=t.parent().parent().find(".pair").last(),i=i.clone().insertAfter(i);2===e.length?(i.find("input.fs-name").val(e[0]),i.find("input.fs-title").val(e[1])):1===e.length&&i.find("input.fs-title").val(e[0])})}).on("click",".field .pairs .action-removeall",function(){confirm("Are you sure?")&&f(this).parent().find(".pair").slice(1).remove()}).on("click",".field .pair .action-delete",function(){1<f(this).closest(".pairs").children(".pair").length?confirm("Are you sure?")&&f(this).closest(".pair").remove():alert("You cannot remove the last item!")}).on("click",".field .header .action-delete",function(){var e;confirm("Are you sure?")&&(e=f(this).closest("li")).fadeOut("slow",function(){e.remove()})}).on("click",".field .header .action-toggle",function(){var e=f(this).closest(".field").find(".body");e.slideToggle(300),f(this).toggleClass("dashicons-arrow-up-alt2"),f(this).toggleClass("dashicons-arrow-down-alt2"),f(this).hasClass("dashicons-arrow-down-alt2")?f(this).parent().find(".name").text((e.find(".f-title").length?"- "+e.find(".f-title").val():"")+" {"+e.find(".f-name").val()+"}"):f(this).parent().find(".name").text("")}).on("click","#add-field-button",function(e){e.preventDefault();e=f("#select-field").val(),e=u.addField(e);f("html, body").animate({scrollTop:f("#"+e).offset().top-50},1e3)}).on("click",".expression_conditional .input-group .action-delete",function(){var e=f(this).closest(".input-group");1<f("#extra-inputs .input-group").length?confirm("Are you sure?")&&e.hide("slow",function(){e.remove()}):alert("You cannot remove the last condition!")}).on("click",".expression_addon .input-group .action-delete",function(){var e=f(this).closest(".input-group");1<f("#addon-inputs .input-group").length?confirm("Are you sure?")&&e.hide("slow",function(){e.remove()}):alert("You cannot remove the last addon!")}).on("click",".action-add-image",function(e){e.preventDefault(),u.wpMediaTarget=f(this),u.wpMediaFrame||(u.wpMediaFrame=wp.media({multiple:!1,button:{text:"Select this image"}}),u.wpMediaFrame.on("select",function(){var e=u.wpMediaFrame.state().get("selection").first().toJSON();"A"===u.wpMediaTarget.prop("tagName")?(u.wpMediaTarget.next("img.wp-media-image-preview").attr("src",e.url),u.wpMediaTarget.next().next("input.wp-media-image-id").attr("value",e.id),u.wpMediaTarget.hide()):(u.wpMediaTarget.attr("src",e.url),u.wpMediaTarget.next("input.wp-media-image-id").attr("value",e.id))})),u.wpMediaFrame.open()}).on("click",".action-add-attachment",function(e){e.preventDefault(),u.wpMediaTarget=f(this),u.wpMediaFrame||(u.wpMediaFrame=wp.media({multiple:!1,button:{text:"Select this file"}}),u.wpMediaFrame.on("select",function(){var e=u.wpMediaFrame.state().get("selection").first().toJSON();u.wpMediaTarget.next("input.wp-media-attachment-id").val(e.id),u.wpMediaTarget.next().next("a.wp-media-attachment-preview").attr("href",e.url).text(e.url)})),u.wpMediaFrame.open()}).on("focus",'[data-type="colorswatches"] input.fs-title',function(e){e.preventDefault();var a=f(this);u.colorpicker.iris("show"),f(".iris-picker").css({top:a.offset().top+40,left:a.offset().left}),u.colorpicker.iris("option","change",function(e,i){a.val(i.color.toString());var t=i.color.toRgb(),t=(t.r+t.g+t.b)/2<200?"#FFFFFF":"#000000";a.css({"background-color":i.color.toString(),color:t})}),u.colorpicker.iris("color",f(this).val())}).on("click","input.allowed-extensions",function(){var e="#"+f(this).closest("li").attr("id"),i=[];f(e+" input.allowed-extensions:checked").each(function(){i.push(f(this).data("extension"))}),f(e+" input.fu-allowed-extensions").val(i.join("|"))}).on("change","input.f-name",function(){var e,i,t=f(this),a=f(this).val().trim();""!==a&&f("#wck_fields_editor input.f-name").each(function(){if(f(this).val()===a&&!f(this).is(t))return alert("The name {"+a+"} is already in use! Choose another name."),t.val(""),!1}),f(this)[0].checkValidity()&&void 0!==f(this).data("lastValid")&&(e=f(this).data("lastValid"))!==a&&(i=!1,f("#wck_expression input[type=text], #wck_fields_editor input.f-visibility, #wck_fields_editor input.f-visibility-readable, #wck_fields_editor input.visibility-readable").each(function(){if(f(this).val().includes(e))return!(i=!0)}),i&&confirm("Wait! Seems like {"+e+"} is used in formulas! Do you want to replace {"+e+"} in all formulas? {"+e+"} will be changed to {"+a+"}")&&(f("#wck_expression input[type=text], #wck_fields_editor input.f-visibility, #wck_fields_editor input.f-visibility-readable, #wck_fields_editor input.visibility-readable").each(function(){f(this).val(f(this).val().replaceAll("{"+e+"}","{"+a+"}").replaceAll("{"+e+":","{"+a+":").replaceAll('"field":"'+e+'"','"field":"'+a+'"'))}),f(this).data("lastValid",a)))}).on("focusin","input.f-name",function(){f(this)[0].checkValidity()&&f(this).data("lastValid",f(this).val())}),f(".iris-square-value").on("click",function(e){e.preventDefault()}),f(document).click(function(e){f(e.target).closest('.iris-picker, [data-type="colorswatches"] input.fs-title').length||f(".iris-picker").is(":visible")&&u.colorpicker.iris("hide")}),f("form#post").submit(function(e){return u.saveFields(),u.saved?(u.saveExpression(),!(!u.expr_saved&&"off"!==u.expression.mode)||(e.preventDefault(),alert("Expression is required. Fill in required fields and try again!"),!1)):(e.preventDefault(),!1)}),u.init=function(){u.fieldList=f("#f-field-list"),u.html=wck_fields_html,u.fields={},u.saved=!1,u.expr_saved=!1,u.counter=0,u.expression={mode:f("input.expression_type:checked").val()},u.loadJSONdata(),u.showExpressionEditor(),u.changeAssignType(),f("form#post").attr("novalidate",""),u.buildTooltips(""),u.updateLayout(),f("#wck-parameters .first-selected").prop("selected",!0)},u.updateLayout=function(){"two-col"===u.fieldsLayout?u.fieldList.addClass("layout-two-col"):u.fieldList.removeClass("layout-two-col")},u.buildTooltips=function(e){f(e+"span.wck-field-tip").tipTip({attribute:"title",defaultPosition:"left"})},u.changeAssignType=function(){var e="1"===f("#assign_type").val();f("#assign_products, #assign_categories, #assign_tags, #assign_attributes").prop("disabled",e),f(".hide-if-disabled").toggle(!e)},f("#assign_type").on("change",u.changeAssignType),u.preloadMedia=function(e,i){wp.media.attachment(e).fetch().then(function(){i(wp.media.attachment(e))})},u.addField=function(e){u.counter+=1;var i="wkfield-"+u.counter;return f("li.welcome",u.fieldList).remove(),u.fieldList.append(f("<li/>",{"data-type":e,class:"form-invalid",id:i}).append(u.html[e].replace("{id}",i))),u.buildTooltips("#"+i+" "),0<f("#"+i).find(".pairs").length&&f("#"+i+" .pairs").sortable({placeholder:"wck-sortable-placeholder",tolerance:"pointer"}),i},f(window).on("beforeunload",function(){if(!1===u.saved)return""}),u.saveFields=function(){u.fields={},n=[];var p=0===f("li .field",u.fieldList).length;if(f("label.error").remove(),u.saved=!1,f("#wck-parameters .defined-fields").html(""),u.appendGlobalParameters(),p)return alert("Please add at least one field before saving."),!1;f("li .field",u.fieldList).each(function(){var e=f(this),i=e.find("input.f-name"),t=e.find("input.f-title"),a=e.find("input.f-hint"),n=e.find("input.f-default-value"),o=e.find("input.f-css-class"),s={type:e.data("type"),use_expression:!0===e.data("use-expression"),name:i.val(),title:t.val(),before_title:e.find("input.f-before-title").val(),after_title:e.find("input.f-after-title").val(),hint:a.val(),default_value:n.val(),css_class:o.val(),layout:u.fieldsLayout,colspan:e.find("input.f-colspan").val(),visibility:e.find("input.f-visibility").val(),visibility_readable:e.find("input.f-visibility-readable").val()};if(0<e.find("select.f-required").length)switch(e.find("select.f-required").val()){case"on":s.required="1";break;case"if-visible":s.required="2";break;case"off":s.required="0"}else s.required="1";i=e.find("input.f-price"),0<i.length&&(s.price=i.val(),""!==s.price&&(s.use_expression=!0)),t=e.find("input.fimg-width");switch(0<t.length&&(s.image_size=t.val()),s.type){case"select":case"radio":case"imageselect":case"imageswatches":case"colorswatches":case"radiogroup":case"checkboxgroup":s.options_name=[],s.options_title=[],"imageselect"!==s.type&&"imageswatches"!==s.type||(s.options_image=[]),"checkboxgroup"===s.type&&(s.select_limit=e.find("input.fcbg-limit").val()),e.find(".fs-option").each(function(){var e=f(this).find("input.fs-title"),i=f(this).find("input.fs-name"),t=f(this).find("input.f-default-value").is(":checked");void 0!==t&&!0===t&&(s.default_value=i.val()+":"+e.val()),s.options_name.push(i.val()+":"+e.val()),s.options_title.push(e.val()),"imageselect"!==s.type&&"imageswatches"!==s.type||(t=f(this).find("input.fs-image"),s.options_image.push(t.val()))});break;case"dropdown":s.options_title=[],e.find(".fs-option").each(function(){var e=f(this).find("input.fs-title"),i=f(this).find("input.f-default-value").is(":checked");void 0!==i&&!0===i&&(s.default_value=e.val()),s.options_title.push(e.val())});break;case"number":var l=e.find("input.fn-min-value"),l=(s.min=l.val(),e.find("input.fn-max-value"));s.max=l.val();break;case"checkbox":l=e.find("select.fcb-default-state");s.default_state="on"===l.val();break;case"text":case"textarea":case"email":var l=e.find("input.ft-min-length"),d=e.find("input.ft-max-length"),r=e.find("input.ft-pattern");s.min=l.val(),s.max=d.val(),0<r.length&&(s.pattern=r.val());break;case"colorpicker":case"datepicker":case"rangedatepicker":l=e.find("input.fdp-disallow-past-date");s.disallow_past_date=l.is(":checked");break;case"imageupload":case"fileupload":s.max_file_size=e.find("input.fu-max-file-size").val(),s.allowed_extensions=e.find("input.fu-allowed-extensions").val();break;case"html":case"paragraph":case"hidden":case"attachment":s.content=e.find(".fst-content").val();break;case"formula":s.content=e.find(".fst-content").val(),s.display_on_user_cart="on"===e.find(".fst-display-on-user-cart").val();break;case"link":s.content=e.find(".fst-content").val(),s.target=e.find(".fst-target").val();break;case"heading":s.content=e.find(".fst-content").val(),s.level=e.find(".fst-level").val()}""!==s.name&&s.name in u.fields&&(p=!0,alert("Field names must be unique! The '"+s.name+"' name is used more than once.")),p||u.appendFormulaVars(s)}),f("form#post")[0].checkValidity()||(p=!0,f("input:invalid").closest(".field").find(".action-toggle.dashicons-arrow-down-alt2").trigger("click"),f("input:invalid").each(function(){f('<label class="error"><span class="dashicons dashicons-warning"></span> '+f(this)[0].validationMessage+"</label>").insertBefore(f(this))})),p&&f("label.error").length&&f("html, body").animate({scrollTop:f("label.error").first().offset().top-160},1e3),u.saveJSONdata(),u.saved=!p},u.appendGlobalParameters=function(){f("#wck-parameters .global-parameters").html(""),f.each(wck_global_parameters,function(t,e){var t="global:"+t,a="";n.push(t),e="object"==typeof e?(f.each(e,function(e,i){a=a+'<option value="{'+t+"}"+("['"+e+"']")+'">'+t.replace("global:","")+"["+e+"] = "+i+"</option>"}),""):" = "+e,f("#wck-parameters .global-parameters").append('<option value="{'+t+'}">'+t.replace("global:","")+e+"</option>"),f("#wck-parameters .global-parameters").append(a)})},u.appendFormulaVars=function(e){(u.fields[e.name]=e).use_expression&&("checkboxgroup"!==e.type?(n.push(e.name),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+'}">"'+e.title+'" value/price {'+e.name+"}</option>")):(n.push(e.name),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+'}">Array of selected values {'+e.name+"}</option>"),n.push(e.name+":sum"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':sum}">Sum of "'+e.title+'" {'+e.name+":sum}</option>"),n.push(e.name+":min"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':min}">Min. value of "'+e.title+'" {'+e.name+":min}</option>"),n.push(e.name+":max"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':max}">Max. value of "'+e.title+'" {'+e.name+":max}</option>")),"text"!==e.type&&"textarea"!==e.type||(n.push(e.name+":text"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':text}">Text value of "'+e.title+'" {'+e.name+":text}</option>")),"rangedatepicker"===e.type?(n.push(e.name+":date_from"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':date_from}">Date "from" of "'+e.title+'" {'+e.name+":date_from}</option>"),n.push(e.name+":date_to"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':date_to}">Date "to" of "'+e.title+'" {'+e.name+":date_to}</option>"),n.push(e.name+":days"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':days}">Days between dates of "'+e.title+'" {'+e.name+":days}</option>")):"datepicker"===e.type?(n.push(e.name+":date"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':date}">Timestamp of "'+e.title+'" {'+e.name+":date}</option>")):"imageupload"!==e.type&&"fileupload"!==e.type||(n.push(e.name+":size"),f("#wck-parameters .defined-fields").append('<option value="{'+e.name+':size}">File size of "'+e.title+'" {'+e.name+":size} [MB]</option>")))},u.saveJSONdata=function(){0<Object.keys(u.fields).length&&f("input[name=_wck_fieldset]").val(JSON.stringify(u.fields))},u.loadJSONdata=function(){var i;"object"==typeof wck_load_fieldset&&(i=!1,f.each(wck_load_fieldset,function(){i||(this.hasOwnProperty("layout")&&"two-col"===this.layout&&f(".wck-toggle-layout").trigger("click"),i=!0);var o,s,l,d,r,p=u.addField(this.type),c=f("#"+p+" .field"),e=(f("#"+p+" .f-name").val(this.name),this.hasOwnProperty("colspan")&&(f("#"+p+" .f-colspan").val(this.colspan),"2"===this.colspan&&f("#"+p+" .wck-toggle-colspan").trigger("click")),f("#"+p+" .f-title").val(this.title),this.hasOwnProperty("before_title")&&f("#"+p+" .f-before-title").val(this.before_title),this.hasOwnProperty("after_title")&&f("#"+p+" .f-after-title").val(this.after_title),f("#"+p+" .f-hint").val(this.hint),f("#"+p+" .f-css-class").val(this.css_class),0<f("#"+p+" .f-required").length&&f("#"+p+" .f-required").val("1"===this.required?"on":"2"===this.required?"if-visible":"off"),this.hasOwnProperty("visibility")&&(f("#"+p+" .f-visibility").val(this.visibility),f("#"+p+" .f-visibility-readable").val(this.visibility_readable),""!==this.visibility_readable&&f("#"+p+" .visibility-readable").val("Rule preview: "+this.visibility_readable)),f("#"+p+" .f-price")),e=(0<e.length&&e.val(this.price),f("#"+p+" .fimg-width"));0<e.length&&e.val(this.image_size),"dropdown"===this.type?(o=this.options_title,l=this.default_value,d=!0,r=null,f.each(o,function(e,i){var t;d?((t=c.find(".fs-option")).find("input.fs-title").val(i),l===i&&(r=t.find("input.f-default-value")),d=!1):((t=c.find(".fs-option").last().clone().insertBefore(f("#"+p+" .fs-options .action-add"))).find("input.fs-title").val(i),l===i&&(r=t.find("input.f-default-value"))),r&&r.prop("checked",!0)})):0<=["select","radio","imageselect","radiogroup","checkboxgroup","imageswatches","colorswatches"].indexOf(this.type)?(e=this.options_name,o=this.options_title,l=this.default_value,"imageselect"!==this.type&&"imageswatches"!==this.type||(s=this.options_image,wp.media.attachment(s).fetch()),"checkboxgroup"===this.type&&f("#"+p+" .fcbg-limit").val(this.select_limit),d=!0,r=null,f.each(e,function(e,i){var t,a,n;0<=i.indexOf(":")&&(i=i.slice(0,i.indexOf(":"))),d?((t=c.find(".fs-option")).find("input.fs-name").val(i),t.find("input.fs-title").val(o[e]),0<(a=t.find("input.fs-image")).length&&(a.val(s[e]),t.find("a.action-add-image").hide(),t.find(".wp-media-image-preview").attr("src",u.iconPreloader),u.preloadMedia(s[e],function(e){t.find(".wp-media-image-preview").attr("src",e.get("url"))})),l===i&&(r=t.find("input.f-default-value")),d=!1):((n=c.find(".fs-option").last().clone().insertBefore(f("#"+p+" .fs-options .action-add"))).find("input.fs-name").val(i),n.find("input.fs-title").val(o[e]),0<(a=n.find("input.fs-image")).length&&(a.val(s[e]),n.find("a.action-add-image").hide(),n.find(".wp-media-image-preview").attr("src",u.iconPreloader),u.preloadMedia(s[e],function(e){n.find(".wp-media-image-preview").attr("src",e.get("url"))})),l===i&&(r=n.find("input.f-default-value"))),r&&r.prop("checked",!0)})):"number"===this.type?(f("#"+p+" .fn-min-value").val(this.min),f("#"+p+" .fn-max-value").val(this.max),f("#"+p+" .f-default-value").val(this.default_value)):"checkbox"===this.type?f("#"+p+" .fcb-default-state").val("1"===this.default_state?"on":"off"):"text"===this.type||"textarea"===this.type||"email"===this.type?(f("#"+p+" .ft-min-length").val(this.min),f("#"+p+" .ft-max-length").val(this.max),f("#"+p+" .f-default-value").val(this.default_value),"text"===this.type&&f("#"+p+" .ft-pattern").val(this.pattern)):"colorpicker"===this.type||"datepicker"===this.type||"rangedatepicker"===this.type?f("#"+p+" .fdp-disallow-past-date").prop("checked",this.disallow_past_date):"imageupload"===this.type||"fileupload"===this.type?(f("#"+p+" .fu-max-file-size").val(this.max_file_size),f("#"+p+" .fu-allowed-extensions").val(this.allowed_extensions),this.allowed_extensions.split("|").forEach(function(e){f("#"+p+" .allowed-extensions.ext-"+e).prop("checked",!0)})):0<=["html","paragraph","heading","hidden","link","attachment","formula"].indexOf(this.type)&&(f("#"+p+" .fst-content").val(this.content),"heading"===this.type?f("#"+p+" .fst-level").val(this.level):"link"===this.type?f("#"+p+" .fst-target").val(this.target):"attachment"===this.type?u.preloadMedia(this.content,function(e){f("#"+p+" .wp-media-attachment-preview").attr("href",e.get("url")).text(e.get("url"))}):"formula"===this.type&&f("#"+p+" .fst-display-on-user-cart").val("1"===this.display_on_user_cart?"on":"off"))}),u.saveFields())},u.showExpressionEditor=function(){f("div.expression_oneline, div.expression_conditional, div.expression_off, div.expression_addon").hide(),f("div.expression_"+u.expression.mode).show(),"off"===u.expression.mode?f(".off-hide").hide():f(".off-hide").show()},f("input.expression_type").on("change",function(){u.expression.mode=f(this).val(),u.expressionLastFocusedInput=null,u.showExpressionEditor()}),u.addCondition=function(e,i,t=!1){var a=f('<div class="input-group"><div class="input-buttons"><span class="action-drag dashicons dashicons-move"></span></div><div class="input-icon input-if"><input type="text" placeholder="Logical expression..." value=""><i></i></div><div class="input-icon input-equation"><input type="text" placeholder="Price formula..." value=""><i></i></div><div class="input-buttons"><span class="action-delete dashicons dashicons-trash"></span></div><div class="clearfix"></div></div>');f(".input-if input",a).val(e),f(".input-equation input",a).val(i),f(!0===t?"div#addon-inputs":"div#extra-inputs").append(a),u.autocomplete()},f("button.add-condition").on("click",function(){u.addCondition()}),f("button.add-addon").on("click",function(){u.addCondition("","",!0)}),u.autocomplete=function(){f(".input-icon input").bind("keydown",function(e){16!==e.keyCode&&219!==e.keyCode||(t[e.keyCode]=!0)}).autocomplete({minLength:0,source:function(e,i){!0===t[16]&&!0===t[219]&&i(n)},focus:function(){return!1},select:function(e,i){return delete t[16],delete t[219],this.value+=i.item.value+"}",!1}})},u.saveExpression=function(){var e,t,i=u.expression.mode;u.expr_saved=!1,"oneline"===i&&(u.expression.expr=f(".expression_oneline input").val(),""!==u.expression.expr&&(u.expr_saved=!0)),"conditional"===i&&(t=[],f(".expression_conditional .input-group").each(function(){var e=f(this).find(".input-if input").val(),i=f(this).find(".input-equation input").val();t.push({type:"condition",if:e,then:i})}),e=f(".expression_conditional .input-else input").val(),t.push({type:"else",if:"true",then:e}),u.expression.expr=t,0<u.expression.expr.length&&(u.expr_saved=!0)),"addon"===i&&(t=[],f(".expression_addon .input-group").each(function(){var e=f(this).find(".input-if input").val(),i=f(this).find(".input-equation input").val();t.push({type:"condition",if:e,then:i})}),u.expression.expr=t,0<u.expression.expr.length&&(u.expr_saved=!0)),"off"===i?f("input[name=_wck_expression]").val("off"):f("input[name=_wck_expression]").val(JSON.stringify(u.expression))},u.loadExpression=function(){"object"==typeof wck_load_expression?(u.expression.mode=wck_load_expression.mode,u.expression.expr=wck_load_expression.expr,"oneline"===u.expression.mode?(f(".expression_oneline input").val(u.expression.expr),f("input[name=_wck_choose_expression_type].expression_oneline").prop("checked",!0),u.showExpressionEditor(),u.addCondition()):"conditional"===u.expression.mode?(f.each(u.expression.expr,function(){"condition"===this.type?u.addCondition(this.if,this.then):"else"===this.type&&f(".input-else input").val(this.then)}),f("input[name=_wck_choose_expression_type].expression_conditional").prop("checked",!0),u.showExpressionEditor()):"addon"===u.expression.mode&&(f.each(u.expression.expr,function(){u.addCondition(this.if,this.then,!0)}),f("input[name=_wck_choose_expression_type].expression_addon").prop("checked",!0),u.showExpressionEditor())):(u.expression.mode="off",f("input[name=_wck_choose_expression_type].expression_off").prop("checked",!0),u.showExpressionEditor(),u.addCondition())},f("button.test-expression").on("click",function(){u.saveExpression()}),u.toolbarOnTop=!1,f(window).scroll(function(){100<f(this).scrollTop()?u.toolbarOnTop||f("#wck-toolbar").fadeOut(function(){u.toolbarOnTop=!0,f("#wck-toolbar").css({top:"0px",bottom:"auto"}).fadeIn()}):f("#postbox-container-2").hasClass("fullscreen")||u.toolbarOnTop&&f("#wck-toolbar").fadeOut(function(){u.toolbarOnTop=!1,f("#wck-toolbar").css({top:"auto",bottom:"0px"}).fadeIn()})}),o.window=f("#wck-cv-builder"),o.builder=o.window.find(".builder"),o.template=o.window.find(".template").children(),o.context=null,o.open=function(i){o.context=i;var t=o.template.find("select.p-field"),a=(t.empty(),u.saveFields(),t.append('<option value="" selected disabled>Choose field...</option>'),f.each(u.fieldList.find(".field"),function(){var e;"static"===f(this).data("group")||f(this).is(i)||(e=f(this).find(".f-name").val(),t.append('<option value="'+e+'">'+e+"</option>"))}),o.builder.append(o.template.clone()),o.builder.find(".or-condition").remove(),o.context.find(".f-visibility").val());try{a=JSON.parse(a)}catch(e){a=!1}"object"==typeof a?f.each(a,function(e,i){var t=!0;f.each(i,function(e,i){o.add(t?"or":"and",null,i),t=!1})}):o.add("or",null,null),o.window.find("span.self-name").text(i.find(".f-name").val()),o.window.show().css({display:"flex"})},o.close=function(){o.window.hide(),o.builder.empty()},o.add=function(e,i,t){(i=null===i?o.builder.find("."+e+"-group").last():i).append(o.window.find(".template ."+e+"-condition").clone());e=i.find(".and-condition").last();null!==t&&"object"==typeof t?(e.find(".p-field").val(t.field),e.find(".p-comparison").val(t.comp).trigger("change"),e.find(".p-value").val(t.value)):e.find(".p-value").val("")},o.validate=function(){var a=!0,e=o.builder.find(".and-condition");return e.find(".validation-error").removeClass("validation-error"),e.each(function(){var e=f(this).find(".p-field"),i=f(this).find(".p-comparison").val(),t=f(this).find(".p-value");[null,""].includes(e.val())&&(e.addClass("validation-error"),a=!1),t.prop("disabled")||""!==t.val()||(t.addClass("validation-error"),a=!1),["5","6","7","8"].includes(i)&&!t.val().match(/^-?\d*[\.,]?\d+$/)&&(t.addClass("validation-error"),a=!1),"9"===i&&""===t.val()&&(t.addClass("validation-error"),a=!1)}),a},o.window.on("click",".cv-action-and",function(e){e.preventDefault(),o.add("and",f(this).prev(),null)}),o.window.on("click",".cv-action-or",function(e){e.preventDefault(),o.add("or",f(this).prev(),null)}),o.window.on("click",".cv-remove",function(e){e.preventDefault(),(1===f(this).closest(".and-group").children().length?f(this).closest(".or-condition"):f(this).parent()).remove()}),o.window.on("change","select.p-comparison",function(e){var i=["1","2"].includes(f(this).val()),t=f(this).next(".p-value");t.prop("disabled",i),i&&t.val("")}),o.window.on("click",".cv-close",function(e){e.preventDefault(),o.close()}),o.window.on("click",".cv-save",function(e){if(e.preventDefault(),!o.validate())return alert("Please correct the form!"),!1;var a=[],n=[],e=(f.each(o.builder.find(".or-condition"),function(){var i=[],t=[];f.each(f(this).find(".and-condition"),function(){var e={field:f(this).find(".p-field").val(),comp:f(this).find(".p-comparison").val(),comp_text:f(this).find(".p-comparison option:selected").text(),value:f(this).find(".p-value").val()};i.push(e),t.push("{"+e.field+"} "+e.comp_text+" "+e.value)}),a.push(i),n.push(" ( "+t.join(" and ")+" ) ")}),n.join(" or ").replaceAll("  "," "));o.context.find(".f-visibility").val(0===a.length?"":JSON.stringify(a)),o.context.find(".f-visibility-readable").val(e),""!==e?o.context.find(".visibility-readable").val("Rule preview: "+e):o.context.find(".visibility-readable").val(""),o.close()}),f("body").on("click",".action-field-visibility",function(){var e=f(this).closest(".field");o.open(e)}),u.init(),u.loadExpression(),u.autocomplete()})}(jQuery);